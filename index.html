<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sendify - LocalSend UI</title>
  <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      display: flex;
      height: 100vh;
      background: #0F1B1E;
      color: white;
    }

    .sidebar {
      width: 250px;
      background: #081416;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .sidebar h1 {
      font-size: 22px;
      font-weight: bold;
      color: white;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
      color: white;
    }

    .menu-item i {
      font-size: 18px;
    }

    .menu-item:hover,
    .menu-item.active {
      background: #1B2A2D;
    }

    .main-content {
      flex-grow: 1;
      padding: 30px;
      display: none;
    }

    .main-content.active {
      display: block;
    }

    .selection {
      display: flex;
      gap: 10px;
    }

    .select-btn {
      background: #1B2A2D;
      color: white;
      padding: 15px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .select-btn:hover {
      background: #2D3D40;
    }

    .select-btn i {
      font-size: 20px;
    }

    .nearby {
      margin-top: 20px;
    }

    .devices {
      background: #1B2A2D;
      padding: 15px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-height: 150px;
      overflow-y: auto;
    }

    .device {
      background: #2D3D40;
      padding: 10px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .device:hover {
      background: #00E0A5;
      color: black;
    }

    .device i {
      font-size: 18px;
    }

    .troubleshoot {
      margin-top: 20px;
      text-align: center;
      color: #00E0A5;
      cursor: pointer;
    }

    .troubleshoot:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h1>LocalSend</h1>
    <div class="menu-item active" data-tab="receive"><i class="fas fa-wifi"></i> Receive</div>
    <div class="menu-item" data-tab="send"><i class="fas fa-play"></i> Send</div>
    <div class="menu-item" data-tab="settings"><i class="fas fa-cog"></i> Settings</div>
  </div>

  <!-- Receive Page -->
  <div class="main-content active" id="receive">
    <h2>Receive Files</h2>
    <p>Waiting for incoming files...</p>
  </div>

  <!-- Send Page -->
  <div class="main-content" id="send">
    <h2>Selection</h2>
    <div class="selection">
      <div class="select-btn" id="fileBtn"><i class="fas fa-file"></i> File</div>
      <div class="select-btn" id="folderBtn"><i class="fas fa-folder"></i> Folder</div>
      <div class="select-btn" id="textBtn"><i class="fas fa-align-left"></i> Text</div>
      <div class="select-btn" id="pasteBtn"><i class="fas fa-clipboard"></i> Paste</div>
    </div>

    <div class="nearby">
      <h3>Nearby devices</h3>
      <div class="devices" id="deviceList">(No devices found)</div>
    </div>

    <div class="troubleshoot">Troubleshoot</div>
  </div>

  <!-- Settings Page -->
  <div class="main-content" id="settings">
    <h2>Settings</h2>
    <p>Settings coming soon...</p>
  </div>

  <script>
    const tabs = document.querySelectorAll(".menu-item");
    const pages = document.querySelectorAll(".main-content");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        tabs.forEach(t => t.classList.remove("active"));
        tab.classList.add("active");

        pages.forEach(page => page.classList.remove("active"));
        document.getElementById(tab.dataset.tab).classList.add("active");
      });
    });

    const WORDS = ["Rocket", "Guitar", "Phoenix"];
    const MAX_NUM = 10;
    const myID = `${WORDS[Math.floor(Math.random() * WORDS.length)]}-${Math.floor(Math.random() * MAX_NUM)}`;

    const deviceList = document.getElementById("deviceList");
    let peer = new Peer(myID);
    let connections = [];

    peer.on("open", () => {
      discoverPeers();
    });

    peer.on("connection", conn => {
      handleIncomingConnection(conn);
    });

    function discoverPeers() {
      const possibleIDs = [];
      WORDS.forEach(word => {
        for (let i = 0; i < MAX_NUM; i++) {
          const candidateID = `${word}-${i}`;
          if (candidateID !== myID) possibleIDs.push(candidateID);
        }
      });

      possibleIDs.forEach(candidate => {
        const conn = peer.connect(candidate, { reliable: true });
        conn.on("open", () => handleIncomingConnection(conn));
      });
    }

    function handleIncomingConnection(conn) {
      if (connections.some(c => c.peer === conn.peer)) return;

      connections.push(conn);
      renderDiscoveredPeers();
    }

    function renderDiscoveredPeers() {
      deviceList.innerHTML = "";
      connections.forEach(conn => {
        const div = document.createElement("div");
        div.className = "device";
        div.innerHTML = `<i class="fas fa-laptop"></i> ${conn.peer}`;
        deviceList.appendChild(div);
      });
    }
  </script>
</body>
</html>
